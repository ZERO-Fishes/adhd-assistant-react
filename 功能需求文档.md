# 背景
根据@原理文档中所阐述的理论，我希望设计一个可以给ADHD患者使用的网页工具

# 功能目标
设计一个能满足原理文档中有关CTDP相关操作的功能

## 功能1：实现用户可编辑的任务单元模板库
- 用户能够设置各种任务单元模板，并保存在本地存储中
- 数据库包含增，改，删，筛选功能
- 每个任务单元模板包含各种需要的信息
-- 模板名称
-- 模板备注，相当于任务的详细描述
-- 模板类型，任务单元应该被分成不同类型，以便用户后续进行组织，而类型的名称和数量应该由用户自定义
-- 任务计时类型，可选择正计时或倒计时，并且正计时可以设定最小时间和最大时间，倒计时可以设定时间
-- **神圣座位约束清单**：用户可设置"神圣座位中绝对不能做的事"列表，用于"下必为例"原则的执行

### 1.1 任务模板管理功能
- **模板创建**：支持创建新的任务模板，包含所有必要信息
- **模板编辑**：支持编辑现有模板的所有属性
- **模板复制**：支持快速复制现有模板，创建相似模板
- **模板删除**：支持删除不需要的模板
- **模板列表**：以列表形式展示所有模板，包含详细信息

### 1.2 任务类型管理系统
- **类型枚举**：预设常用任务类型（学习、工作、运动、休息、娱乐）
- **类型自定义**：用户可以添加、编辑、删除任务类型
- **颜色管理**：每个任务类型支持自定义背景色和文字色
- **颜色预览**：添加和编辑类型时提供实时颜色预览
- **类型选择**：模板创建时通过下拉选择框选择类型，选项显示对应颜色
- **类型显示**：模板列表中任务类型以彩色标签形式显示

### 1.3 时间设置优化
- **时分输入**：时间设置支持小时和分钟输入，而非仅秒数
- **时间转换**：自动将时分输入转换为秒数存储
- **时间显示**：模板列表中时间信息以友好的时分格式显示
- **默认值**：提供合理的默认时间设置

### 1.4 约束清单管理
- **动态添加**：支持动态添加和删除约束项
- **清单显示**：模板列表中显示约束清单内容
- **约束提示**：无约束时显示"无约束"提示

## 功能2：实现CTDP核心机制
### 2.1 预约机制（线性时延原理）
- 用户能够选择一个已创建的任务模板，并选择预约时间，开启一次预约
- 提供"预约开始"按钮，替代原文中的预约信号（如响指）
- 预约开始后开始一个预约倒计时，实时显示剩余时间
- 如果用户在预约倒计时内点击"任务开始"按钮，则根据任务模板中的任务计时类型开启一个计时
- 如果用户在预约倒计时内没有开启任务，或者手动选择放弃预约，则表明"预约失败"

### 2.2 任务执行机制（神圣座位原理）
- 提供"任务开始"按钮，替代原文中的神圣座位触发信号
- 任务计时开始后，如果倒计时结束或者超过了正计时的最小时间，则表明"任务完成成功"
- 如果任务计时开始后，倒计时没有结束或者没有到正计时的最小时间用户就选择了放弃，则"任务完成失败"
- 超过正计时的最小时间后，用户可以选择"完成"来完成整个任务

### 2.3 判例法约束（下必为例原理）
- 任务执行期间，系统监控用户是否违反"神圣座位约束清单"
- 一旦检测到违规行为，用户必须在以下两个选项中选择其一：
  - 判定整个任务链立即失败，清空所有当前已累积的节点记录，下一次只能从 #1 重新开始
  - 判定允许当前行为，但从此以后，该行为在后续任务中也必须永久允许，不得再视作违规
- 系统记录所有判例决定，形成动态的约束边界

## 功能3：任务链管理系统
### 3.1 任务链结构
- 支持层级化的任务链结构，使用可嵌套的数据结构
- 任务链与任务单元完全解耦，只有引用关系
- 任务链节点记录：第一次成功为 #1，第二次成功为 #2，依此类推
- 任务链失败时，清空所有节点记录，重新从 #1 开始

### 3.2 实时状态显示
- 实时显示当前任务链的状态（当前节点编号、连续成功次数等）
- 显示当前预约倒计时或任务计时的剩余时间
- 预约倒计时和任务计时不同时显示，按流程切换

## 功能4：记录回溯与统计
- 用户能够查看过去任务计时的时间段和完成情况
- 用户可以查看之前完成任务和完成预约的最大连续次数和当前连续次数
- 提供任务历史的可视化展示，包括时间轴、完成率统计等
- 支持数据导出功能，用于备份和跨设备同步

## 功能5：技术实现要求
### 5.1 平台支持
- 纯网页应用，支持现代浏览器
- 响应式设计，在移动端浏览器上正常显示和使用
- 支持离线使用（PWA技术）
- 可部署为在线网站供他人使用

### 5.2 数据存储
- 使用本地存储（localStorage/IndexedDB）保存数据
- 支持数据导出功能，格式为JSON
- 支持数据导入功能，用于备份和跨设备同步
- 不进行网络传输，保护用户隐私

### 5.3 用户界面
- 提供"预约开始"和"任务开始"按钮，替代物理信号
- 实时显示任务链状态和计时信息
- 任务历史可视化展示
- 简洁直观的操作界面

### 5.4 界面交互优化
- **导航系统**：多页面导航，包含首页、任务模板、任务链、历史记录、设置
- **模态框设计**：任务模板编辑和类型管理采用模态框设计
- **弹窗管理**：任务类型管理采用弹窗形式，不占用主页面空间
- **颜色预览**：类型管理中的颜色选择提供实时预览功能
- **响应式布局**：适配桌面端和移动端显示
- **状态反馈**：操作完成后提供明确的成功/失败反馈

### 5.5 数据管理功能
- **本地存储**：所有数据存储在浏览器本地，支持离线使用
- **数据导入导出**：支持JSON格式的数据备份和恢复
- **数据验证**：输入数据时进行格式和重复性验证
- **数据同步**：类型修改后自动更新所有相关界面

## 功能范围（Scope）

- **包含的内容**：
  - 前端页面交互（HTML/CSS/JavaScript）
  - 本地数据存储和管理
  - CTDP核心机制实现
  - 任务链管理系统
  - 数据导入导出功能
  - 响应式设计
  - 任务模板管理系统
  - 任务类型管理系统
  - 颜色管理和预览功能
  - 模态框和弹窗交互
  - PWA离线支持

- **不包含的内容**：
  - 后端服务器
  - 用户账户系统
  - 云端数据同步
  - 复杂的用户权限管理
  - 多用户协作功能
  - 高级数据分析功能

## 已实现功能清单

### ✅ 核心功能
- [x] 任务模板创建、编辑、删除、复制
- [x] 任务类型管理系统（添加、编辑、删除、颜色管理）
- [x] 时间设置优化（时分输入、自动转换）
- [x] 约束清单管理（动态添加、显示）
- [x] CTDP预约机制（预约开始、倒计时）
- [x] CTDP任务执行机制（任务开始、计时）
- [x] 判例法约束（约束清单、违规处理）
- [x] 数据导入导出（JSON格式）
- [x] 本地数据存储（localStorage）

### ✅ 界面功能
- [x] 多页面导航系统
- [x] 模态框设计（模板编辑、类型管理）
- [x] 弹窗管理（类型管理弹窗）
- [x] 颜色预览功能
- [x] 响应式设计（桌面端、移动端）
- [x] 实时状态显示
- [x] 操作反馈提示

### ✅ 用户体验
- [x] 直观的颜色选择器
- [x] 实时预览功能
- [x] 友好的时间显示格式
- [x] 彩色类型标签
- [x] 约束清单显示
- [x] 模板复制功能
- [x] 数据验证和错误提示

### 🔄 待实现功能
- [ ] 任务链管理系统
- [ ] 历史记录可视化
- [ ] 统计数据展示
- [ ] 任务链层级管理
- [ ] 连续成功次数统计