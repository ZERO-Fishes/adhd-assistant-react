# 预约放弃调试说明

## 调试步骤

### 1. 清除现有数据
在测试前，建议先清除现有的历史记录数据：
1. 进入历史记录页面
2. 点击"清空历史"按钮
3. 确认清除

### 2. 测试预约放弃
1. 选择一个任务模板
2. 点击"预约开始"
3. 立即点击"放弃"按钮
4. 确认放弃操作

### 3. 查看控制台输出
打开浏览器开发者工具（F12），查看控制台输出，应该看到以下信息：

```
预约放弃，保存失败记录: {template: {...}, scheduledAt: ..., sessionId: "..."}
会话ID: [会话ID]
保存预约记录: {sessionId: "...", type: "appointment", status: "failed", ...}
预约记录已保存
DataManager: 添加历史记录: {id: "...", sessionId: "...", type: "appointment", ...}
DataManager: 历史记录已保存，当前记录数量: 1
```

### 4. 检查历史记录
1. 进入历史记录页面
2. 查看是否显示预约失败记录

## 可能的问题

### 问题1：没有控制台输出
**原因：** 预约放弃方法没有被调用
**检查：** 确认点击了"放弃"按钮，并且确认了放弃操作

### 问题2：有控制台输出但历史记录为空
**原因：** 数据保存失败或显示逻辑有问题
**检查：** 查看控制台是否有错误信息

### 问题3：历史记录显示但信息不完整
**原因：** 预约记录保存成功但显示逻辑有问题
**检查：** 查看控制台中的记录数据结构

## 预期结果

预约放弃后，历史记录应该显示：

```
[任务名称] [任务类型]                    [失败] [删除]
🕐 开始时间

📅 预约信息                                    [失败]
开始时间: HH:MM    等待时间: null

预约失败，任务未开始
```

## 调试信息说明

### 控制台输出含义
- `预约放弃，保存失败记录:` - 显示当前预约对象
- `会话ID:` - 显示当前会话ID
- `保存预约记录:` - 显示要保存的记录数据
- `预约记录已保存` - 确认记录保存成功
- `DataManager: 添加历史记录:` - 显示最终保存的记录
- `DataManager: 历史记录已保存，当前记录数量:` - 显示当前总记录数

### 数据验证
检查保存的记录是否包含：
- `type: "appointment"`
- `status: "failed"`
- `sessionId: [正确的会话ID]`
- `timeNodes.appointmentStart: [预约开始时间]`
- `timeNodes.abandonTime: [放弃时间]`

## 如果问题仍然存在

如果按照上述步骤测试后，预约放弃仍然没有显示，请提供：
1. 控制台的完整输出
2. 历史记录页面的截图
3. 具体的操作步骤

这样我可以进一步诊断问题所在。
