# 任务与预约成功失败记录逻辑

## 记录逻辑说明

### 预约阶段
- **预约时放弃** → 预约失败
- **预约期间开启任务** → 预约成功

### 任务阶段
- **任务倒计时结束或正计时到达最小时间** → 任务完成（成功）
- **中途放弃** → 任务失败

## 时间节点记录

每个历史记录现在包含以下详细时间节点：

### 预约记录 (type: 'appointment')
```javascript
timeNodes: {
  appointmentStart: Date,    // 预约开始时间
  taskStart: null,          // 任务开始时间（预约记录中为null）
  taskEnd: null,            // 任务结束时间（预约记录中为null）
  abandonTime: Date|null    // 放弃时间（仅预约失败时有值）
}
```

### 任务记录 (type: 'task')
```javascript
timeNodes: {
  appointmentStart: Date,    // 预约开始时间
  taskStart: Date,          // 任务开始时间
  taskEnd: Date|null,       // 任务结束时间（仅任务成功时有值）
  abandonTime: Date|null    // 放弃时间（仅任务失败时有值）
}
```

## 状态判断逻辑

### 预约状态
- **success**: 预约倒计时完成，用户点击了"任务开始"按钮
- **failed**: 用户在预约期间点击了"放弃"按钮

### 任务状态
- **success**: 任务倒计时结束或正计时到达最小时间
- **failed**: 用户在任务期间点击了"放弃"按钮

## 历史记录显示

### 预约阶段显示
- 显示预约开始时间和结束时间
- 状态标签：成功/失败
- 时间格式：开始: HH:MM | 结束: HH:MM

### 任务阶段显示
- 显示任务开始时间和结束时间
- 显示实际执行时长
- 状态标签：成功/失败
- 时间格式：开始: HH:MM | 结束: HH:MM

## 数据结构更新

### DataManager.addHistoryRecord()
新增 `timeNodes` 字段，包含四个时间节点：
- `appointmentStart`: 预约开始时间
- `taskStart`: 任务开始时间
- `taskEnd`: 任务结束时间
- `abandonTime`: 放弃时间

### 应用逻辑更新
- `startAppointment()`: 记录预约开始时间
- `startTask()`: 记录任务开始时间
- `handleAppointmentAbandon()`: 记录预约放弃时间
- `handleTaskAbandon()`: 记录任务放弃时间
- `handleTaskComplete()`: 记录任务完成时间

## 可视化准备

所有时间节点都已记录，为后续的可视化功能（如时间轴、甘特图等）做好了数据准备。每个时间节点都包含完整的Date对象，可以用于：

1. 计算各阶段持续时间
2. 分析用户行为模式
3. 生成时间轴图表
4. 统计成功率趋势
5. 识别时间分布规律
